DDE4 Install and Launch Instructions
Fry Feb 16, 2022,  updated May 12, 2022

You can see instructions by browsing:
 https://github.com/cfry/dde/blob/dde4/dde/dde4_install_launch.txt

DDE4 can be installed on your Mac or Windows computer,
OR installed on Dexter itself. This documentation tells you how.

_________DDE4 Install on Mac or Windows__________
DDE4 requires Node v 18 to be installed.
To check if your computer already has this:
   - Launch a Terminal (or Command Prompt)
         - MacOS:  - double click on Applications/terminal
                   - Type in: node --version
         - WinOS:  On Start menu,
                   if there is no node.js you must install it.
                   If there is node.js click on it.
              then chose option: node.js
              - at top of screen see the version.
                (old versions of Node 11 should be updated to version 16
                  via the below instructions)

- Browse: nodejs.org/
- Click the big green button for Downloading the LTS version (node version 16)
- This will put a file in your Downloads folder, named something like:
  node-v16.14.0.pkg
- Double click the file
- This brings up a dialog box. Click continue, agree, install buttons
  as they come up. (do not install Chocholaty)

- Browse: https://github.com/cfry/dde/tree/dde4
- Click the big green button "Code v", and choose "Download ZIP"
- In your Downloads folder, unzip the file dde-dde4.zip
  (on Mac ,just double click it.)

- Make a folder on your computer.
  (On WinOS: right click, New, Folder)
  A good location is in your Documents folder or the parent of your Documents folder
  Name it dde4

- Unzip Downloads/dde-dde4.ZIP
   (Double click on it, or drag the below file into the newly created dde4 folder.)

- Move: Downloads/dde-dde4/httpd.mjs into your newly created dde4 folder.
- Move: Downloads/dde-dde4/dde/  into your newly created dde4 folder.

We want to end up with the dde4 folder containing just:
   httpd.mjs
   dde/

- Launch a terminal program or Command Prompt:
  On MacOS, Double click on Applications/Utilities/Terminal.app

- cd (change directory) to your newly created dde4 folder.

- Type in: npm install ws@^7.5.1    (ws version 8 is incompatible with the way we create a new Server)
- Type in: npm install formidable@^2.0.1
- Type in: npm install modbus-serial@^8.0.5

__________DDE4 Install Node on Dexter____________
DDE4 requires an updated version of Node (v 16) to be on your Dexter.
First check to see if you need the new version of node:
- In a Terminal
  - Type in: ssh root@192.168.1.142  (or your Dexter's IP address)
     When prompted, enter Password:  klg

  - Type in: node --version
       (old versions of Node 11 should be updated to version 16
       via the below instructions)

- Browse: nodejs.org/dist/v16.13.1/
    click:  node-v16.13.1-linux-armv7l.tar.xz
    This is for Dexter's arm71 processor. Its 17Mbytes. Now in fry downloads folder.
  OR
  Browse: https://nodejs.org/en/download/current/
     in the Linux binaries row click "ARMv7" to download it
     

- Untar this file.
  On MacOS, double click it
  On WinOS
     You can Launch a Terminal (ie Powershell) app:
       - Type in: cd Downloads
       - Type in: tar -xJvf node-v16.13.1-linux-armv7l.tar.xz

     OR use winzip, winrar or 7zip application to unzip (untar) this big file.

- Copy the file named "node" (possibly bin/node, about 75Mbytes)  file to your Dexter:
  First we must stop node from running on your Dexter.
  from a terminal program:
  ssh root@192.168.1.142 //To ssh into Dexter From a mac terminal.
         you will be prompted for the password. Use: klg
  cd /usr/bin
  pkill node  //to stop node from running.
  mv node node_11  //for backup and we will use this file later.

    Copy (on your Win or Mac)  downloads/node-v16.13.1-linux-armv7l/bin/node
    To   (on Dexter)           /usr/bin/node (name of the destination file)
   - On MacOS use cyberduck application to transfer
   - On WinOS use cyberduck application to transfer
    You can also use, from your Mac or Win, a terminal program using "scp"
    scp first arg is the file you want to transfer,
    which might be in a dfferent location if you
    unzipped to somewhere else.

    scp downloads/node-v16.13.1-linux-armv7l/bin/node root@192.168.1.142:/usr/bin/
        (prompts you for a password. Use: klg )

   -  In ssh session to dexter, set node's permissions via enter:
    chmod node --reference=node_11  to fix up executable permissions to
            those permissions of the previous version of node
            which should be: -rwxr-xr-x
    or
    chmod +rwxrwxrwx node
    node &   //to run node
    to verify that you have the new version running, enter:
    node --version
     and it should give you a version 16 of node.



The Node server requires 2 extra npm packages:
formidable  and ModbusRTU, but these should
already be on your Dexter.

_____Install DDE4 server on Dexter_______
copy dde folder to inside : Dexter folder: /srv/samba/share/www
Using Cyberduck:
  click button "openconnection"  OR File Menu/OpenConnection
  choose option FTP/SFTP
  Enter: server: 192.168.1.142
         port:    (leave the default at 22)
         username: root
         password: klg
    click the "connect"  button
    You should see the file structure of Dexter:
    Navigate to: /srv/samba/share/www
    In the Cyberduck dialog box title bar, click on "Action"
      to get a dropdown menu, choose "Upload".
    Navigate to the dde folder on your Mac/Win and select that "dde" folder.
      (this dde folder will have in it subfolders of
           build,doc,examples, etc. )
      and click the "upload" button in the lower right of the dialog box.

    Now upload the file "httpd.mjs" (the server) (in the same folder as the dde that
     you just uploaded.
    we want to upload httpd.mjs into Dexter /srv/samba/share/www/

    Now upload the file "jobs.html" (in the same folder as the dde that
     you just uploaded.
    we want to upload jobs.html into Dexter /srv/samba/share/www/

    in ssh,
    cd /srv/samba/share/www
    chmod +rwxrwxrwx httpd.mjs




__________Launching the DDE4 Server_________

- Launch a Terminal
  On MacOS: Double click on the file: Applications/Utilities/terminal.app
  On WinOS: bring up Command prompt.

- Type in: cd  dde4  (or where ever you put your dde4 folder)
- Type in: node httpd.mjs


   On Dexter:
   - Type in: ssh root@192.168.1.142  (or your Dexter's IP address)
        When prompted, enter Password:  klg
   - Type in:  cd /srv/samba/share
   - Type in:  pkill node          (stop the original server)
   - Type in:  node www/httpd.mjs  (start the new server)

___________Starting DDE4___________
For Server on MacOS or WinOS to launch DDE:
  - In the Chrome Web browser, browse: localhost/dde/index.html
    (stick this URL in the Favorites bar for quick launches.)

For Server on Dexter to launch DDE:
  - In the Chrome Web browser, browse: 192.168.1.142/dde/index.html 

You should see the DDE4 user interface page come up.

________Starting Job Engine_______
For Server on MacOS or WinOS to launch Job Engine:
  - In the Chrome Web browser, browse: localhost/dde/jobs.html

For Server on Dexter to launch Job Engine:
  - In the Chrome Web browser, browse: 192.168.1.142/dde/jobs.html 

                               

